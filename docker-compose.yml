services:
  # 1. 网易云音乐 API 服务
  netease-api:
    image: moefurina/ncm-api:latest
    container_name: music-party-netease
    restart: always
    environment:
      - PORT=3000
      - HTTPS=true
    networks:
      - music-net

  # 2. Music Party 主应用
  music-party:
    build: .
    container_name: music-party-app
    ports:
      - "8848:8080" 
    environment:
      - ADMIN_PASSWORD=admin123
      - NETEASE_API_URL=http://netease-api:3000
      
      # 填入你的 B站 SESSDATA 
      - BILIBILI_SESSDATA=""
      
      # 填入你的网易云 Cookie 
      - NETEASE_COOKIE=""

      # 队列与限制配置
      - QUEUE_MAX_SIZE=1000          # 播放队列最大长度
      - QUEUE_HISTORY_SIZE=50        # 历史记录保留数量
      - PLAYLIST_IMPORT_LIMIT=100    # 导入歌单时的最大歌曲数
      - CHAT_HISTORY_LIMIT=1000      # 聊天历史记录保留数量
      - CACHE_MAX_SIZE=1GB           # 本地音乐缓存上限 (e.g. 512MB, 2GB)
    depends_on:
      - netease-api
    networks:
      - music-net
    volumes:
      - ./cached_media:/app/cached_media
